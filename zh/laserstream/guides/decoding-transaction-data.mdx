---
title: è§£ç å’Œè§£æäº¤æ˜“æ•°æ®
sidebarTitle: è§£ç äº¤æ˜“æ•°æ®
description: äº†è§£å¦‚ä½•è§£ç å’Œè§£ææ¥è‡ªLaserstreamçš„äº¤æ˜“æ•°æ®ï¼Œä»¥æ›´å¥½åœ°ç†è§£Solanaäº¤æ˜“ã€‚
---

**å½“æ‚¨ä»Laserstreamæ¥æ”¶äº¤æ˜“æ•°æ®æ—¶ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„æ–¹é¢éœ€è¦æ³¨æ„ï¼š**

- **Message** â†’ ç”¨æˆ·æƒ³è¦åšä»€ä¹ˆï¼ˆä»–ä»¬ç­¾ç½²çš„ææ¡ˆï¼‰
- **Meta** â†’ å®é™…å‘ç”Ÿäº†ä»€ä¹ˆï¼ˆæ‰§è¡Œç»“æœï¼‰

**æŒ‘æˆ˜ï¼š** åŸå§‹äº¤æ˜“æ•°æ®ä»¥äºŒè¿›åˆ¶å­—èŠ‚æ•°ç»„çš„å½¢å¼å‡ºç°ï¼Œå¦‚ `<Buffer 00 bf a0 e8...>`ï¼Œè€Œä¸æ˜¯å¯è¯»çš„åœ°å€å’Œç­¾åã€‚

**æœ¬æŒ‡å—å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ï¼š** å°†è¿™äº›äºŒè¿›åˆ¶æ•°æ®è§£ç ä¸ºäººç±»å¯è¯»çš„æ ¼å¼ï¼Œæå–æœ‰æ„ä¹‰çš„ä¿¡æ¯ï¼Œå¹¶ç†è§£ä»ææ¡ˆåˆ°æ‰§è¡Œçš„å®Œæ•´äº¤æ˜“è¿‡ç¨‹ã€‚

---

## å®æ—¶æµï¼Œæ— éœ€è§£ç 

è¿è¡Œä¸‹é¢çš„æœ€å°å®¢æˆ·ç«¯ã€‚è¿‡æ»¤æ ‡å¿—ä¼šä¸¢å¼ƒæŠ•ç¥¨å’Œå¤±è´¥çš„äº¤æ˜“ï¼ŒaccountsIncludeæ•°ç»„å°†ç»“æœé™åˆ¶ä¸ºæ¶‰åŠJupiterç¨‹åºIDçš„æ´»åŠ¨ã€‚

```ts [expandable]
import { subscribe, CommitmentLevel, SubscribeUpdate, LaserstreamConfig } from 'helius-laserstream';

async function runTransactionSubscription() {
  const config: LaserstreamConfig = {
    apiKey: 'your-api-key',
    endpoint: 'laserstream-endpoint',
  };

  const request = {
    transactions: {
      "Jupiter-transactions": {
        vote: false,
        failed: false,
        accountsInclude: ['JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4']
      }
    },
    commitment: CommitmentLevel.PROCESSED,
    accounts: {}, slots: {}, transactionsStatus: {}, blocks: {}, blocksMeta: {}, entry: {}, accountsDataSlice: []
  };

  const stream = await subscribe(
    config,
    request,
    (u: SubscribeUpdate) => console.log('ğŸ’¸ Transaction update', u),
    console.error
  );

  console.log(`âœ… stream id â†’ ${stream.id}`);
  process.on('SIGINT', () => { stream.cancel(); process.exit(0); });
}
runTransactionSubscription().catch(console.error);
```

æ‚¨çš„æ§åˆ¶å°ç°åœ¨æ˜¾ç¤ºä¸€ä¸ªåŒ…è£…å™¨â€”`filters`, `createdAt` åŠ ä¸Šä¸€ä¸ª `transaction` åˆ†æ”¯ï¼Œéšè—äº†ä¸¤ä¸ªå­é¡¹ï¼š

* `transaction.transaction.transaction` â†’ ç­¾åçš„**æ¶ˆæ¯**
* `transaction.transaction.meta` â†’ æ‰§è¡Œçš„**å…ƒæ•°æ®**

```json
{
 filters: [ 'Jupiter-transactions' ],
  account: undefined,
  transaction: {
    transaction: {
      signature: <Buffer 00 bf a0 e8 9f cc 84 0c a4 83 e3 97 cd b7 57 e2 2b bc 1d ca 8c a6 1b ce b5 57 d7 47 5e ec 1f 46 ae b2 2d 6a 12 cb 88 48 1d 07 bf f6 b2 d3 a8 0b c9 04 ... 14 more bytes>,
      transaction: [Object],
      meta: [Object],
      index: '1177'
    },
    slot: '351704819'
  },
  transactionStatus: undefined,
  block: undefined,
  blockMeta: undefined,
  entry: undefined,
  ping: undefined,
  pong: undefined,
  createdAt: 2025-07-07T10:58:44.403Z
}
```

ç›®å‰ï¼Œæ‰€æœ‰çœ‹èµ·æ¥åƒ `Uint8Array` çš„å†…å®¹ä»ç„¶ä¸é€æ˜ã€‚

å½“æ‚¨è¿è¡Œå¸¦æœ‰è§£ç åŠŸèƒ½çš„è„šæœ¬æ—¶ï¼Œæ‚¨å°†çœ‹åˆ°å®é™…çš„åµŒå¥—ç»“æ„å’Œå¯è¯»çš„åœ°å€ï¼š

```json [expandable]
{
  "filters": ["Jupiter-transactions"],
  "account": undefined,
  "transaction": {
    "transaction": {
      "signature": "5u62i53R1Hdc4thm6DQTNWNkyypuJJSaXSMwwQDxNqKMaAw62H1Xa3Md7QDhYjoPk5dCPg18fwz83kUR6TrMviTx",
      "transaction": {
        "message": {
          "header": {
            "numRequiredSignatures": 1,
            "numReadonlySignedAccounts": 0,
            "numReadonlyUnsignedAccounts": 8
          },
          "accountKeys": [
            "AF9KFSWQeKVxd3kVvFvysWXmATHyYzrN8zN8GtXn4qTF",
            "G9VzXwhDPQ8KRbQAJN6TyGf2gWukYDAvmnXJhPZFev4f",
            "ES9qPxWQVMRZkobJ9yr3U6XSrXzGNLJdSe6p6fS7b82T",
            "JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4",
            "ComputeBudget111111111111111111111111111111",
            "ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL",
            "So11111111111111111111111111111111111111112",
            "11111111111111111111111111111111",
            "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"
          ],
          "recentBlockhash": "8sGjRxJHLJVWqpHt5UdN8qxtLLdgcnLKBpFj9Qrn5PNF",
          "instructions": [
            {
              "programIdIndex": 4,
              "accounts": [],
              "data": "3bjaAzoXPjbY"
            },
            {
              "programIdIndex": 3,
              "accounts": [0, 1, 2, 5, 6, 7, 8],
              "data": "2L1xoA2KEqBgWfGt3fwFJK8k4FPJRJzYHRgH4R3xC8A7"
            }
          ]
        },
        "signatures": [
          "5u62i53R1Hdc4thm6DQTNWNkyypuJJSaXSMwwQDxNqKMaAw62H1Xa3Md7QDhYjoPk5dCPg18fwz83kUR6TrMviTx"
        ]
      },
      "meta": {
        "err": null,
        "fee": 12500,
        "preBalances": [1075517572, 0, 207594496815, 0, 0, 0, 0, 0, 0],
        "postBalances": [1075502572, 1461600, 207594496815, 2001231920, 2039280, 0, 0, 0, 0],
        "innerInstructions": [
          {
            "index": 1,
            "instructions": [
              {
                "programIdIndex": 5,
                "accounts": [1, 2, 0],
                "data": "3Bxs4h24hBtQy9rw"
              }
            ]
          }
        ],
        "logMessages": [
          "Program ComputeBudget111111111111111111111111111111 invoke [1]",
          "Program ComputeBudget111111111111111111111111111111 success",
          "Program JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4 invoke [1]",
          "Program log: Instruction: Swap",
          "Program ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL invoke [2]",
          "Program log: Create",
          "Program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA invoke [3]",
          "Program log: Instruction: GetAccountDataSize",
          "Program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA consumed 1569 of 242833 compute units",
          "Program return: TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA pQAAAAAAAAA=",
          "Program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA success",
          "Program JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4 success"
        ],
        "preTokenBalances": [],
        "postTokenBalances": [],
        "computeUnitsConsumed": 182564
      },
      "index": "1177"
    },
    "slot": "351709933"
  },
  "transactionStatus": undefined,
  "block": undefined,
  "blockMeta": undefined,
  "entry": undefined,
  "ping": undefined,
  "pong": undefined,
  "createdAt": "2025-01-14T10:58:44.403Z"
}
```

---

## è§£ç äºŒè¿›åˆ¶æ•°æ®

**ä¸ºä»€ä¹ˆè¦è§£ç ï¼Ÿ** åŸå§‹ Laserstream æ•°æ®åŒ…å«ç­¾åã€è´¦æˆ·å¯†é’¥å’Œå“ˆå¸Œï¼Œä»¥äºŒè¿›åˆ¶ `Uint8Array` å¯¹è±¡å½¢å¼å­˜åœ¨ï¼Œä¸å¯è¯»ã€‚æ‚¨éœ€è¦å°†è¿™äº›è½¬æ¢ä¸º base58 å­—ç¬¦ä¸²ï¼Œä»¥ä¾¿ç†è§£äº¤æ˜“ã€‚

**è§£å†³æ–¹æ¡ˆï¼š** Laserstreamä½¿ç”¨Yellowstone gRPCï¼Œå®ƒæä¾›äº†å†…ç½®çš„è§£ç å·¥å…·ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªé€’å½’å‡½æ•°å°†æ‰€æœ‰äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºäººç±»å¯è¯»çš„æ ¼å¼ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ç§å­—æ®µç±»å‹ç¼–å†™å•ç‹¬çš„è§£ç å™¨ã€‚

```ts [expandable]
import bs58 from 'bs58';
import { subscribe, CommitmentLevel, SubscribeUpdate, LaserstreamConfig } from 'helius-laserstream';

// Recursive function to convert all Buffer/Uint8Array fields to base58
function convertBuffers(obj: any): any {
  if (!obj) return obj;
  if (Buffer.isBuffer(obj) || obj instanceof Uint8Array) {
    return bs58.encode(obj);
  }
  if (Array.isArray(obj)) {
    return obj.map(item => convertBuffers(item));
  }
  if (typeof obj === 'object') {
    return Object.fromEntries(
      Object.entries(obj).map(([key, value]) => [key, convertBuffers(value)])
    );
  }
  return obj;
}

async function runTransactionSubscription() {
  const config: LaserstreamConfig = {
    apiKey: 'your-api-key',
    endpoint: 'laserstream-endpoint',
  };

  const request = {
    transactions: {
      "Jupiter-transactions": {
        vote: false,
        failed: false,
        accountsInclude: ['JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4']
      }
    },
    commitment: CommitmentLevel.PROCESSED,
    accounts: {}, slots: {}, transactionsStatus: {}, blocks: {}, blocksMeta: {}, entry: {}, accountsDataSlice: []
  };

  const stream = await subscribe(
    config,
    request,
    (update: SubscribeUpdate) => {
      if (update.transaction) {
        // Convert all binary fields to human-readable format
        const decodedTransaction = convertBuffers(update.transaction);
        console.log('ğŸ’¸ Decoded transaction:', JSON.stringify(decodedTransaction, null, 2));
        
        // Or process specific fields
        processTransaction(update.transaction);
      }
    },
    console.error
  );

  console.log(`âœ… stream id â†’ ${stream.id}`);
  process.on('SIGINT', () => { stream.cancel(); process.exit(0); });
}

function processTransaction(txUpdate: any) {
  const tx = txUpdate.transaction;
  const meta = tx.meta;
  
  console.log('Transaction Details:');
  console.log('- Signature:', bs58.encode(tx.signature));
  console.log('- Slot:', txUpdate.slot);
  console.log('- Success:', meta.err === null);
  console.log('- Fee:', meta.fee, 'lamports');
  console.log('- Compute Units:', meta.computeUnitsConsumed);
  
  // Account keys are already available in the message
  const message = tx.transaction.message;
  if (message.accountKeys) {
    console.log('- Account Keys:');
    message.accountKeys.forEach((key: Uint8Array, index: number) => {
      console.log(`  ${index}: ${bs58.encode(key)}`);
    });
  }
  
  // Log messages are already UTF-8 strings
  if (meta.logMessages && meta.logMessages.length > 0) {
    console.log('- Log Messages:');
    meta.logMessages.forEach((log: string) => {
      console.log(`  ${log}`);
    });
  }
}

runTransactionSubscription();
```

è¿™ç§æ–¹æ³•åˆ©ç”¨äº†å†…ç½®çš„è§£ç åŠŸèƒ½ï¼ŒåŒæ—¶å¤„ç†éœ€è¦æ‰‹åŠ¨è½¬æ¢çš„äºŒè¿›åˆ¶å­—æ®µã€‚äº¤æ˜“ç»“æ„å·²ç»è¢«è§£æ - ä½ åªéœ€è¦å°†äºŒè¿›åˆ¶å­—æ®µè½¬æ¢ä¸ºäººç±»å¯è¯»çš„æ ¼å¼ã€‚

---

## ç†è§£äº¤æ˜“ç»“æ„

ç°åœ¨æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è§£ç åçš„æ•°æ®ï¼Œè®©æˆ‘ä»¬æ¥æ¢ç´¢æ¯ä¸ª Laserstream äº¤æ˜“æ›´æ–°çš„ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ã€‚è®°ä½åœ¨æˆ‘ä»¬æœ€åˆçš„ä¾‹å­ä¸­ï¼Œæ¯ä¸ªäº¤æ˜“åŒ…å«ä¸¤ä¸ªå…³é”®å¯¹è±¡ï¼š

- **æ¶ˆæ¯ï¼ˆææ¡ˆï¼‰** â†’ `transaction.transaction.transaction` â†’ ç­¾åçš„æ¶ˆæ¯ï¼ˆç”¨æˆ·çš„ææ¡ˆï¼‰
- **å…ƒæ•°æ®ï¼ˆæ‰§è¡Œï¼‰** â†’ `transaction.transaction.meta` â†’ æ‰§è¡Œå…ƒæ•°æ®ï¼ˆéªŒè¯è€…çš„å“åº”ï¼‰

è¿™ç§ä¸¤éƒ¨åˆ†ç»“æ„è®²è¿°äº†ä¸€ä¸ªå®Œæ•´çš„æ•…äº‹ï¼šç”¨æˆ·è¯·æ±‚äº†ä»€ä¹ˆä¸å®é™…å‘ç”Ÿäº†ä»€ä¹ˆã€‚è®©æˆ‘ä»¬è¯¦ç»†æ£€æŸ¥æ¯ä¸ªéƒ¨åˆ†ã€‚

---

## ææ¡ˆï¼šæ¶ˆæ¯ä¸­çš„æ‰€æœ‰å†…å®¹

ç”¨æˆ·åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯ï¼ŒæŒ‡å®š*ä»€ä¹ˆ*ï¼Œ*è°*ä»¥åŠ*ä½•æ—¶ä¸ºæ­¢*ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•è§£ç æ¯ä¸ªéƒ¨åˆ†ï¼š

### äº¤æ˜“å¤´

```json
{
  "header": {
    "numRequiredSignatures": 1,
    "numReadonlySignedAccounts": 0,
    "numReadonlyUnsignedAccounts": 5
  }
}
```

`numRequiredSignatures` å‘Šè¯‰éªŒè¯è€…éœ€è¦éªŒè¯å¤šå°‘ä¸ªç­¾åï¼Œè€Œä¸¤ä¸ª `numReadonly*` å€¼æ ‡è®°è¿è¡Œæ—¶å¯ä»¥è§†ä¸ºåªè¯»çš„è´¦æˆ·ï¼Œä»è€Œå®ç°å¹¶è¡Œæ‰§è¡Œã€‚

### è´¦æˆ·å¯†é’¥å­—å…¸

```json
{
  "accountKeys": [
    "7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5",
    "JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4",
    "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",
    "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",
    "So11111111111111111111111111111111111111112",
    "11111111111111111111111111111111"
  ]
}
```

`accountKeys` æ˜¯ä¸€ä¸ªå…¬å…±å¯†é’¥çš„ç®€å•åˆ—è¡¨ï¼Œä½œä¸ºæŸ¥æ‰¾è¡¨ã€‚äº¤æ˜“ä¸­çš„æ¯ä¸ªåç»­æ•´æ•° - `programIdIndex`ï¼Œæ¯ä¸ªæŒ‡ä»¤çš„ `accounts` æ•°ç»„ä¸­çš„å…ƒç´  - é€šè¿‡ç´¢å¼•æŒ‡å›æ­¤åˆ—è¡¨ï¼Œæ¯æ¡æ¶ˆæ¯èŠ‚çœè¶…è¿‡ä¸€åƒå­—èŠ‚ã€‚

### é˜²é‡æ”¾ä¿æŠ¤

```json
{
  "recentBlockhash": "8sGjRxJHLJVWqpHt5UdN8qxtLLdgcnLKBpFj9Qrn5PNF"
}
```

`recentBlockhash` ä¸€æ—¦æ»šå‡ºæœ€å 150 ä¸ªåŒºå—å“ˆå¸Œåå°±ä¼šè¿‡æœŸï¼Œåœ¨ä¸»ç½‘ä¸Šå¤§çº¦æ˜¯ä¹åç§’ã€‚

### æŒ‡ä»¤ï¼šå®é™…å‘½ä»¤

```json
{
  "instructions": [
    {
      "programIdIndex": 10,
      "data": "HnkkG7"
    },
    {
      "programIdIndex": 15,
      "accounts": "3vtmrQMafzDoG2CBz1iqgXPTnC",
      "data": "5jRcjdixRUDKQKUEt6oHJ747HCB3vWb5y"
    }
  ]
}
```

æ¯ä¸ªæŒ‡ä»¤åŒ…å«ä¸‰ä¸ªå…³é”®éƒ¨åˆ†ï¼š

- **ç¨‹åº ID** (`programIdIndex`): æŒ‡å‘ `accountKeys` æ•°ç»„ä¸­çš„ä¸€ä¸ªåœ°å€ï¼ˆä¾‹å¦‚ï¼Œç´¢å¼• 10 = `ComputeBudget111111111111111111111111111111`ï¼‰
- **è´¦æˆ·** (`accounts`): ä¸€ä¸ª base58 ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ­¤æŒ‡ä»¤æ¶‰åŠçš„è´¦æˆ·ç´¢å¼•
- **æ•°æ®** (`data`): å®é™…çš„æŒ‡ä»¤æ•°æ®ï¼Œç¼–ç ä¸º base58

ç”±äº `convertBuffers` å‡½æ•°ï¼Œè´¦æˆ·æ˜¾ç¤ºä¸º base58ï¼Œä½†å®é™…ä¸ŠåŒ…å«è´¦æˆ·ç´¢å¼•ï¼ˆä¾‹å¦‚ï¼Œ`"3vtmrQMafzDoG2CBz1iqgXPTnC"` è§£ç ä¸ºç´¢å¼• [21, 19, 12, 17, 2, 6, 1, 22]ï¼‰

è¿™ç§è®¾è®¡æ„å‘³ç€æ¯ä¸ªæŒ‡ä»¤åªéœ€å¼•ç”¨æŸ¥æ‰¾è¡¨ä¸­çš„ä½ç½®ï¼Œè€Œä¸æ˜¯é‡å¤å®Œæ•´çš„ 32 å­—èŠ‚åœ°å€ã€‚

### ç­¾åï¼šæˆæƒè¯æ˜

```json
{
  "signatures": [
    "5u62i53R1Hdc4thm6DQTNWNkyypuJJSaXSMwwQDxNqKMaAw62H1Xa3Md7QDhYjoPk5dCPg18fwz83kUR6TrMviTx"
  ]
}
```

`signatures` åŒ…å«è¯æ˜æ‰€éœ€è´¦æˆ·æˆæƒæ­¤äº¤æ˜“çš„åŠ å¯†ç­¾åã€‚ç­¾åæ•°é‡å¿…é¡»ä¸ `header.numRequiredSignatures` åŒ¹é…ã€‚

### åœ°å€è¡¨æŸ¥æ‰¾

```json
{
  "addressTableLookups": [
    {
      "accountKey": "5Q544fKrFoe6tsEbD7S8EmxGTJYAKtTVhAW5Q5pge4j1",
      "writableIndexes": [0, 1],
      "readonlyIndexes": [2, 3, 4]
    }
  ],
  "versioned": true
}
```

å¦‚æœ `versioned` æ˜¯ `true`ï¼Œåˆ™ `addressTableLookups` ä»¥é“¾ä¸Šè¡¨å’Œä¸¤ä¸ªç´¢å¼•åˆ—è¡¨çš„å½¢å¼å‡ºç°ã€‚æŸ¥æ‰¾è¡¨å°†åœ°å€æ•°é‡çš„ç¡¬æ€§ä¸Šé™æå‡åˆ°å‡ åä¸ªï¼ŒåŒæ—¶ä¿æŒæ•°æ®åŒ…åœ¨ 1,232 å­—èŠ‚çš„ MTU ä¹‹å†…ã€‚

### å¦‚ä½•è¿æ¥ï¼šæµç¨‹

ä»åŸºæœ¬åŸç†æ¥çœ‹ï¼Œä»¥ä¸‹æ˜¯å‘ç”Ÿçš„äº‹æƒ…ï¼š

1. **æ„å»ºæŸ¥æ‰¾è¡¨**ï¼š`accountKeys` åˆ—å‡ºæ­¤äº¤æ˜“å°†æ¶‰åŠçš„æ‰€æœ‰åœ°å€
2. **è®¾ç½®è§„åˆ™**ï¼š`header` æŒ‡å®šéœ€è¦å¤šå°‘ä¸ªç­¾åä»¥åŠå“ªäº›è´¦æˆ·æ˜¯åªè¯»çš„
3. **åˆ›å»ºå‘½ä»¤**ï¼šæ¯ä¸ª `instruction` æŒ‡å‘ï¼š
   - ä¸€ä¸ªç¨‹åºï¼ˆé€šè¿‡ `programIdIndex` â†’ `accountKeys[index]`ï¼‰
   - å®ƒéœ€è¦çš„è´¦æˆ·ï¼ˆé€šè¿‡ `accounts` â†’ å¤šä¸ª `accountKeys[index]` ä½ç½®ï¼‰
   - æŒ‡ä»¤æ•°æ®ï¼ˆç¼–ç åœ¨ `data` ä¸­ï¼‰
4. **æ·»åŠ æˆæƒ**ï¼š`signatures` è¯æ˜æ‰€éœ€è´¦æˆ·æ‰¹å‡†äº†æ­¤äº¤æ˜“
5. **è®¾ç½®è¿‡æœŸæ—¶é—´**ï¼š`recentBlockhash` ç¡®ä¿æ­¤äº¤æ˜“ä¸èƒ½åœ¨ä»¥åé‡æ”¾

---

## æ‰§è¡Œï¼šmeta ä¸­çš„ä¸€åˆ‡

æ¶ˆæ¯æ˜¾ç¤ºç”¨æˆ·æƒ³è¦åšä»€ä¹ˆï¼Œè€Œ meta æ˜¾ç¤ºéªŒè¯è€…æ‰§è¡Œäº¤æ˜“æ—¶å®é™…å‘ç”Ÿçš„äº‹æƒ…ã€‚

### åŸºæœ¬æ‰§è¡Œä¿¡æ¯

**æˆåŠŸ/å¤±è´¥**

```json
{
  "err": null,
  "fee": 12500
}
```

- `err: null` = æˆåŠŸ
- `err: {...}` = å¤±è´¥å¹¶å¸¦æœ‰é”™è¯¯è¯¦æƒ…
- `fee` = æ­¤äº¤æ˜“æ”¶å–çš„ lamports

**ä½™é¢å˜åŠ¨**

```json
{
  "preBalances": [1075517572, 0, 207594496815, 0, 0, 0, 0, 0, 0],
  "postBalances": [1075502572, 1461600, 207594496815, 2001231920, 2039280, 0, 0, 0, 0]
}
```

ä½™é¢æ•°ç»„æŒ‰ç´¢å¼•å¯¹åº”äº `accountKeys` æ•°ç»„ï¼š
- è´¦æˆ· 0ï¼šæŸå¤± 15000 lamportsï¼ˆæ‰‹ç»­è´¹ï¼‰
- è´¦æˆ· 1ï¼šè·å¾— 1461600 lamportsï¼ˆæ–°è´¦æˆ·åˆ›å»ºï¼‰
- è´¦æˆ· 3ï¼šè·å¾— 2001231920 lamportsï¼ˆç¨‹åºè´¦æˆ·ï¼‰

**è®¡ç®—ä½¿ç”¨æƒ…å†µ**

```json
{
  "computeUnitsConsumed": 182564
}
```

æ˜¾ç¤ºä½¿ç”¨äº†å¤šå°‘è®¡ç®—é¢„ç®—ï¼ˆä»è¯·æ±‚çš„é‡‘é¢ä¸­ï¼‰ã€‚

### é«˜çº§æ‰§è¡Œç»†èŠ‚

**å†…éƒ¨æŒ‡ä»¤**

```json
{
  "innerInstructions": [
    {
      "index": 1,
      "instructions": [
        {
          "programIdIndex": 5,
          "accounts": [1, 2, 0],
          "data": "3Bxs4h24hBtQy9rw"
        }
      ]
    }
  ]
}
```

å†…éƒ¨æŒ‡ä»¤æ˜¯ç¨‹åºåœ¨æ‰§è¡ŒæœŸé—´è°ƒç”¨çš„é™„åŠ æŒ‡ä»¤ã€‚å®ƒä»¬ä¸æ˜¯åŸå§‹äº¤æ˜“çš„ä¸€éƒ¨åˆ†ï¼Œä½†ç”±ä¸»è¦æŒ‡ä»¤è§¦å‘ã€‚

**æ—¥å¿—æ¶ˆæ¯**

```json
{
  "logMessages": [
    "Program ComputeBudget111111111111111111111111111111 invoke [1]",
    "Program ComputeBudget111111111111111111111111111111 success",
    "Program JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4 invoke [1]",
    "Program log: Instruction: Swap",
    "Program ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL invoke [2]",
    "Program log: Create",
    "Program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA invoke [3]",
    "Program log: Instruction: GetAccountDataSize",
    "Program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA consumed 1569 of 242833 compute units",
    "Program return: TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA pQAAAAAAAAA=",
    "Program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA success",
    "Program JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4 success"
  ]
}
```

æ—¥å¿—æ¶ˆæ¯æä¾›ç¨‹åºæ‰§è¡Œçš„æ—¶é—´é¡ºåºè·Ÿè¸ªï¼Œæ˜¾ç¤ºè°ƒç”¨äº†å“ªäº›ç¨‹åºä»¥åŠå®ƒä»¬è¾“å‡ºçš„ä»»ä½•è‡ªå®šä¹‰æ—¥å¿—æ¶ˆæ¯ã€‚

**ä»£å¸ä½™é¢å˜åŠ¨**

```json
{
  "preTokenBalances": [],
  "postTokenBalances": [
    {
      "accountIndex": 1,
      "mint": "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",
      "owner": "7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5",
      "uiTokenAmount": {
        "amount": "1000000",
        "decimals": 6,
        "uiAmount": 1.0,
        "uiAmountString": "1"
      }
    }
  ]
}
```

ä»£å¸ä½™é¢å˜åŠ¨æ˜¾ç¤º SPL ä»£å¸è´¦æˆ·çš„å‰/åçŠ¶æ€ï¼ŒåŒ…æ‹¬å…·æœ‰é€‚å½“å°æ•°å¤„ç†çš„äººç±»å¯è¯»é‡‘é¢ã€‚

---

## å®ç”¨è§£ç æ¨¡å¼

ä»¥ä¸‹æ˜¯ä»è§£ç äº¤æ˜“ä¸­æå–æœ‰ç”¨ä¿¡æ¯çš„å¸¸è§æ¨¡å¼ï¼š

```typescript
// Transaction Success
function isTransactionSuccessful(meta: any): boolean {
  return meta.err === null;
}

function getTransactionFee(meta: any): number {
  return meta.fee;
}

function getComputeUnitsUsed(meta: any): number {
  return meta.computeUnitsConsumed;
}

// Balance Changes
function getBalanceChanges(meta: any, accountKeys: string[]): Array<{account: string, change: number}> {
  const changes = [];
  
  for (let i = 0; i < meta.preBalances.length; i++) {
    const change = meta.postBalances[i] - meta.preBalances[i];
    if (change !== 0) {
      changes.push({
        account: accountKeys[i],
        change: change
      });
    }
  }
  
  return changes;
}

// Program Calls
function getInvokedPrograms(meta: any, accountKeys: string[]): string[] {
  const programs = new Set<string>();
  
  meta.logMessages.forEach((log: string) => {
    const match = log.match(/Program ([1-9A-HJ-NP-Za-km-z]{32,}) invoke/);
    if (match) {
      programs.add(match[1]);
    }
  });
  
  return Array.from(programs);
}

// Token Transfers
function getTokenTransfers(meta: any): Array<{mint: string, from: string, to: string, amount: number}> {
  const transfers = [];
  
  // Compare pre and post token balances
  const preBalances = new Map();
  const postBalances = new Map();
  
  meta.preTokenBalances.forEach((balance: any) => {
    preBalances.set(balance.accountIndex, balance);
  });
  
  meta.postTokenBalances.forEach((balance: any) => {
    postBalances.set(balance.accountIndex, balance);
  });
  
  // Find changes
  for (const [accountIndex, postBalance] of postBalances) {
    const preBalance = preBalances.get(accountIndex);
    const preAmount = preBalance ? parseInt(preBalance.uiTokenAmount.amount) : 0;
    const postAmount = parseInt(postBalance.uiTokenAmount.amount);
    
    if (preAmount !== postAmount) {
      transfers.push({
        mint: postBalance.mint,
        account: postBalance.owner,
        change: postAmount - preAmount,
        decimals: postBalance.uiTokenAmount.decimals
      });
    }
  }
  
  return transfers;
}
```

---

## å®Œæ•´ç¤ºä¾‹ï¼šJupiter äº¤æ¢è§£ç å™¨

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼Œè§£ç  Jupiter äº¤æ¢äº¤æ˜“å¹¶æå–æœ‰æ„ä¹‰çš„ä¿¡æ¯ï¼š

```typescript [expandable]
import bs58 from 'bs58';
import { subscribe, CommitmentLevel, SubscribeUpdate, LaserstreamConfig } from '../client';

interface SwapInfo {
  signature: string;
  slot: number;
  user: string;
  inputMint: string;
  outputMint: string;
  inputAmount: number;
  outputAmount: number;
  fee: number;
  success: boolean;
}

function convertBuffers(obj: any): any {
  if (!obj) return obj;
  if (Buffer.isBuffer(obj) || obj instanceof Uint8Array) {
    return bs58.encode(obj);
  }
  if (Array.isArray(obj)) {
    return obj.map(item => convertBuffers(item));
  }
  if (typeof obj === 'object') {
    return Object.fromEntries(
      Object.entries(obj).map(([key, value]) => [key, convertBuffers(value)])
    );
  }
  return obj;
}

function decodeJupiterSwap(txUpdate: any): SwapInfo | null {
  const tx = txUpdate.transaction;
  const meta = tx.meta;
  const message = tx.transaction.message;
  
  // Convert binary fields to readable format
  const signature = bs58.encode(tx.signature);
  const accountKeys = message.accountKeys.map((key: any) => bs58.encode(key));
  
  // Check if this is a Jupiter transaction
  const jupiterProgram = "JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4";
  if (!accountKeys.includes(jupiterProgram)) {
    return null;
  }
  
  // Extract user (first account is typically the fee payer/user)
  const user = accountKeys[0];
  
  // Get token balance changes
  const tokenChanges = getTokenTransfers(meta);
  
  // Find input (negative change) and output (positive change)
  const inputChange = tokenChanges.find(change => change.change < 0);
  const outputChange = tokenChanges.find(change => change.change > 0);
  
  if (!inputChange || !outputChange) {
    return null;
  }
  
  return {
    signature,
    slot: parseInt(txUpdate.slot),
    user,
    inputMint: inputChange.mint,
    outputMint: outputChange.mint,
    inputAmount: Math.abs(inputChange.change),
    outputAmount: outputChange.change,
    fee: meta.fee,
    success: meta.err === null
  };
}

function getTokenTransfers(meta: any): Array<{mint: string, change: number}> {
  const transfers = [];
  
  const preBalances = new Map();
  const postBalances = new Map();
  
  meta.preTokenBalances.forEach((balance: any) => {
    preBalances.set(balance.accountIndex, balance);
  });
  
  meta.postTokenBalances.forEach((balance: any) => {
    postBalances.set(balance.accountIndex, balance);
  });
  
  for (const [accountIndex, postBalance] of postBalances) {
    const preBalance = preBalances.get(accountIndex);
    const preAmount = preBalance ? parseInt(preBalance.uiTokenAmount.amount) : 0;
    const postAmount = parseInt(postBalance.uiTokenAmount.amount);
    
    if (preAmount !== postAmount) {
      transfers.push({
        mint: postBalance.mint,
        change: postAmount - preAmount
      });
    }
  }
  
  return transfers;
}

async function runJupiterSwapMonitor() {
  const config: LaserstreamConfig = {
    apiKey: 'your-api-key',
    endpoint: 'laserstream-endpoint',
  };

  const request = {
    transactions: {
      "Jupiter-swaps": {
        vote: false,
        failed: false,
        accountsInclude: ['JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4']
      }
    },
    commitment: CommitmentLevel.PROCESSED,
    accounts: {}, slots: {}, transactionsStatus: {}, blocks: {}, blocksMeta: {}, entry: {}, accountsDataSlice: []
  };

  const stream = await subscribe(
    config,
    request,
    (update: SubscribeUpdate) => {
      if (update.transaction) {
        const swapInfo = decodeJupiterSwap(update.transaction);
        if (swapInfo) {
          console.log('ğŸ”„ Jupiter Swap:');
          console.log(`  User: ${swapInfo.user}`);
          console.log(`  Input: ${swapInfo.inputAmount} of ${swapInfo.inputMint}`);
          console.log(`  Output: ${swapInfo.outputAmount} of ${swapInfo.outputMint}`);
          console.log(`  Fee: ${swapInfo.fee} lamports`);
          console.log(`  Success: ${swapInfo.success}`);
          console.log(`  Signature: ${swapInfo.signature}`);
          console.log('---');
        }
      }
    },
    console.error
  );

  console.log(`âœ… Jupiter swap monitor started (id: ${stream.id})`);
  process.on('SIGINT', () => { stream.cancel(); process.exit(0); });
}

runJupiterSwapMonitor().catch(console.error);
```

æ­¤ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ç»“åˆæ¶ˆæ¯è§£ç ä¸å…ƒåˆ†æï¼Œä»å¤æ‚çš„ DeFi äº¤æ˜“ä¸­æå–ä¸ä¸šåŠ¡ç›¸å…³çš„ä¿¡æ¯ã€‚

---

## å…³é”®è¦ç‚¹

- **åŒéƒ¨åˆ†ç»“æ„**ï¼šæ¯ä¸ªäº¤æ˜“éƒ½æœ‰ä¸€ä¸ª**æ¶ˆæ¯**ï¼ˆè¯·æ±‚çš„å†…å®¹ï¼‰å’Œ**å…ƒæ•°æ®**ï¼ˆå®é™…å‘ç”Ÿçš„å†…å®¹ï¼‰
- **äºŒè¿›åˆ¶è§£ç **ï¼šä½¿ç”¨ `bs58.encode()` å°†äºŒè¿›åˆ¶å­—æ®µè½¬æ¢ä¸ºå¯è¯»çš„base58å­—ç¬¦ä¸²
- **è´¦æˆ·å¯†é’¥æŸ¥æ‰¾**ï¼šæŒ‡ä»¤é€šè¿‡ `accountKeys` æ•°ç»„ä¸­çš„ç´¢å¼•å¼•ç”¨è´¦æˆ·
- **ä½™é¢è·Ÿè¸ª**ï¼šæ¯”è¾ƒ `preBalances` å’Œ `postBalances` ä»¥æŸ¥çœ‹å˜åŒ–

ç†è§£Solanaäº¤æ˜“çš„å…³é”®åœ¨äºè®¤è¯†åˆ°å®ƒä»¬æ˜¯ä¸ºæ•ˆç‡è€Œè®¾è®¡çš„ï¼šé€šè¿‡ä½¿ç”¨æŸ¥æ‰¾è¡¨å’Œç´¢å¼•æ¥æœ€å°åŒ–äº¤æ˜“å¤§å°ï¼ŒåŒæ—¶æœ€å¤§åŒ–ä¿¡æ¯å¯†åº¦ï¼Œè€Œä¸æ˜¯é‡å¤åœ°å€ã€‚
