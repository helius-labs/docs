---
title: getTokenAccountsByOwnerV2
og:title: getTokenAccountsByOwnerV2 Solana RPC 方法
sidebarTitle: getTokenAccountsByOwnerV2
description: getTokenAccountsByOwner 的增强版本，具有附加功能，包括基于游标的分页和 changedSinceSlot
  支持，以便高效检索由特定钱包地址拥有的 SPL 代币账户。
og:description: 获取免费 RPC 并探索具有分页支持的 getTokenAccountsByOwnerV2 RPC
  方法。包括请求参数、响应示例、代码片段，以及在 Solana 主网和 Devnet 上的浏览器内测试。
openapi: /zh/openapi/rpc-http/getTokenAccountsByOwnerV2.yaml POST /
---

## 概述

`getTokenAccountsByOwnerV2` 是标准 `getTokenAccountsByOwner` 方法的增强版本，专为高效查询代币组合和处理拥有大量代币的钱包而设计。此方法引入了基于游标的分页和增量更新功能。

<Info>
**V2 的新功能：**
- **基于游标的分页**：每个请求可配置从 1 到 10,000 个代币账户的限制
- **增量更新**：使用 `changedSinceSlot` 仅获取最近修改的代币账户
- **组合可扩展性**：高效处理拥有数千个代币账户的钱包
- **向后兼容性**：支持所有现有的 `getTokenAccountsByOwner` 参数和过滤器
</Info>

<Warning>
**过滤器要求**：您必须在查询中提供 `mint`（特定代币）或 `programId`（SPL 代币或 Token-2022 程序）。不支持在没有过滤器的情况下查询所有代币类型的所有者。
</Warning>

## 主要优势

<CardGroup cols={2}>
  <Card title="大型组合" icon="wallet">
    处理拥有数千个代币账户的钱包，无超时或内存问题
  </Card>
  <Card title="实时跟踪" icon="chart-line">
    使用 `changedSinceSlot` 进行增量更新，实时监控组合变化
  </Card> 
</CardGroup>

## 分页最佳实践

<Warning>
**重要的分页行为**：分页结束仅在**没有返回代币账户**时指示。由于过滤，API 可能返回少于您限制的账户 - 始终继续分页，直到 `paginationKey` 是 `null`。
</Warning>

### 基本组合查询

```typescript
// Get all SPL Token accounts for a wallet
let allTokenAccounts = [];
let paginationKey = null;

do {
  const response = await fetch(`https://mainnet.helius-rpc.com/?api-key=${API_KEY}`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      jsonrpc: '2.0',
      id: '1',
      method: 'getTokenAccountsByOwnerV2',
      params: [
        "9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM", // wallet address
        { "programId": "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA" },
        {
          encoding: 'jsonParsed',
          limit: 1000,
          ...(paginationKey && { paginationKey })
        }
      ]
    })
  });
  
  const data = await response.json();
  allTokenAccounts.push(...data.result.value);
  paginationKey = data.result.paginationKey;
} while (paginationKey);

console.log(`Total token accounts: ${allTokenAccounts.length}`);
```

### 增量组合更新

```typescript
// Get only token accounts modified since a specific slot
const portfolioUpdates = await fetch(`https://mainnet.helius-rpc.com/?api-key=${API_KEY}`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    jsonrpc: '2.0',
    id: '1',
    method: 'getTokenAccountsByOwnerV2',
    params: [
      walletAddress,
      { "programId": "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA" },
      {
        encoding: 'jsonParsed',
        limit: 1000,
        changedSinceSlot: lastUpdateSlot // Only get recent changes
      }
    ]
  })
});
```

## 代币程序支持

<Tip>
**Token-2022 支持**：使用 `TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb` 作为 `programId` 查询具有扩展功能的 Token-2022 账户，如转账费用、计息代币等。
</Tip>

```typescript
// Query Token-2022 accounts (supports token extensions)
const token2022Response = await fetch(`https://mainnet.helius-rpc.com/?api-key=${API_KEY}`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    jsonrpc: '2.0',
    id: '1',
    method: 'getTokenAccountsByOwnerV2',
    params: [
      walletAddress,
      { "programId": "TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb" }, // Token-2022
      { encoding: 'jsonParsed', limit: 1000 }
    ]
  })
});
```

## 从 getTokenAccountsByOwner 迁移

迁移很简单 - 只需在现有查询中添加分页参数：

```diff
{
  "jsonrpc": "2.0",
  "id": "1",
- "method": "getTokenAccountsByOwner",
+ "method": "getTokenAccountsByOwnerV2",
  "params": [
    "9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM",
    { "programId": "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA" },
    {
      "encoding": "jsonParsed",
+     "limit": 1000
    }
  ]
}
```

## 相关方法

<CardGroup cols={2}>
  <Card title="getTokenAccountsByOwner" icon="wallet" href="/zh/api-reference/rpc/http/gettokenaccountsbyowner">
    无分页的原始方法
  </Card>
  <Card title="getProgramAccountsV2" icon="code" href="/zh/api-reference/rpc/http/getprogramaccountsv2">
    用于程序账户查询的 V2 方法
  </Card>
</CardGroup>
