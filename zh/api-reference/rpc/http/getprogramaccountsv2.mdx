---
title: getProgramAccountsV2
og:title: getProgramAccountsV2 Solana RPC 方法
sidebarTitle: getProgramAccountsV2
description: getProgramAccounts 的增强版本，支持基于游标的分页和 changedSinceSlot，用于高效查询由特定
  Solana 程序拥有的大量账户，并进行增量更新。
og:description: 获取免费 RPC 并探索支持分页的 getProgramAccountsV2 RPC
  方法。包括请求参数、响应示例、代码片段，以及在 Solana 主网和 Devnet 上的浏览器内测试。
openapi: /zh/openapi/rpc-http/getProgramAccountsV2.yaml POST /
---

## 概述

`getProgramAccountsV2` 是标准 `getProgramAccounts` 方法的增强版本，专为需要高效查询特定 Solana 程序拥有的大量账户的应用程序设计。此方法引入了基于游标的分页和增量更新功能。

<Info>
**V2 的新功能：**
- **基于游标的分页**：每个请求可配置从 1 到 10,000 个账户的限制
- **增量更新**：使用 `changedSinceSlot` 仅获取最近修改的账户
- **更好的性能**：防止超时并减少大数据集的内存使用
- **向后兼容性**：支持所有现有的 `getProgramAccounts` 参数
</Info>

## 主要优势

<CardGroup cols={2}>
  <Card title="可扩展查询" icon="chart-line">
    通过高效分页处理拥有数百万账户的程序
  </Card>
  <Card title="实时同步" icon="arrows-rotate">
    使用 `changedSinceSlot` 进行增量更新和实时数据同步
  </Card>
  <Card title="防止超时" icon="clock">
    以前超时的大型查询现在通过分页可靠地工作
  </Card>
  <Card title="内存高效" icon="microchip">
    分块处理数据，而不是一次性加载所有数据到内存中
  </Card>
</CardGroup>

## 分页最佳实践

<Warning>
**重要的分页行为**：分页结束仅在**没有返回账户**时指示。由于过滤，API 可能返回少于限制的账户 - 始终继续分页，直到 `paginationKey` 是 `null`。
</Warning>

### 基本分页模式

```typescript
let allAccounts = [];
let paginationKey = null;

do {
  const response = await fetch(`https://mainnet.helius-rpc.com/?api-key=${API_KEY}`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      jsonrpc: '2.0',
      id: '1',
      method: 'getProgramAccountsV2',
      params: [
        "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",
        {
          encoding: 'base64',
          filters: [{ dataSize: 165 }],
          limit: 5000,
          ...(paginationKey && { paginationKey })
        }
      ]
    })
  });
  
  const data = await response.json();
  allAccounts.push(...data.result.accounts);
  paginationKey = data.result.paginationKey;
} while (paginationKey);
```

### 增量更新

```typescript
// Get only accounts modified since slot 150000000
const incrementalUpdate = await fetch(`https://mainnet.helius-rpc.com/?api-key=${API_KEY}`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    jsonrpc: '2.0',
    id: '1',
    method: 'getProgramAccountsV2',
    params: [
      programId,
      {
        encoding: 'jsonParsed',
        limit: 1000,
        changedSinceSlot: 150000000
      }
    ]
  })
});
```

## 性能提示

<Tip>
**最佳限制大小**：对于大多数用例，每次请求 1,000-5,000 个账户的限制提供了性能和可靠性的最佳平衡。
</Tip>

- **从较小的限制开始** (1000)，并根据网络性能增加
- **使用适当的编码**：`jsonParsed` 方便，`base64` 性能优越
- **应用过滤器** 在分页前减少数据集大小
- **存储 `paginationKey`** 以便在查询中断时恢复
- **监控响应时间** 并相应调整限制

## 从 getProgramAccounts 迁移

从原始方法迁移很简单 - 只需替换方法名称并添加分页参数：

{/* 代码占位符_327a8a2824a8afc7b100da1b1226a792 */}

## 相关方法

<CardGroup cols={2}>
  <Card title="getProgramAccounts" icon="code" href="/zh/api-reference/rpc/http/getprogramaccounts">
    无分页的原始方法
  </Card>
  <Card title="getTokenAccountsByOwnerV2" icon="wallet" href="/zh/api-reference/rpc/http/gettokenaccountsbyownerv2">
    用于查询代币账户的 V2 方法
  </Card>
</CardGroup>
