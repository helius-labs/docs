asyncapi: 3.0.0
info:
  title: Helius Laserstream WebSocket API
  version: 1.0.0

channels:
  accountSubscribe:
    title: Account Subscribe
    description: >-
      Subscribe to an account to receive notifications when the lamports or data for a given account public key changes.

    address: /
    messages:
      accountSubscribeRequest:
        $ref: '#/components/messages/AccountSubscribeRequest'
      accountSubscribeResponse:
        $ref: '#/components/messages/AccountSubscribeResponse'
      accountNotification:
        $ref: '#/components/messages/AccountNotification'

servers:
  mainnet:
    host: mainnet.helius-rpc.com
    protocol: wss
    description: Production Solana mainnet environment
    security:
      - $ref: "#/components/securitySchemes/ApiKeyQuery"
  devnet:
    host: devnet.helius-rpc.com
    protocol: wss
    description: Solana devnet environment for testing
    security:
      - $ref: "#/components/securitySchemes/ApiKeyQuery"

operations:
  accountSubscribeMessage:
    action: receive
    channel:
      $ref: '#/channels/accountSubscribe'
    messages:
      - $ref: '#/channels/accountSubscribe/messages/accountSubscribeRequest'
  receiveAccountSubscribeResponse:
    action: send
    channel:
      $ref: '#/channels/accountSubscribe'
    messages:
      - $ref: '#/channels/accountSubscribe/messages/accountSubscribeResponse'
  receiveAccountNotification:
    action: send
    channel:
      $ref: '#/channels/accountSubscribe'
    messages:
      - $ref: '#/channels/accountSubscribe/messages/accountNotification'

components:
  securitySchemes:
    ApiKeyQuery:
      type: httpApiKey
      name: api-key
      in: query
      description: Your Helius API key. You can get one for free in the [dashboard](https://dashboard.helius.dev/api-keys).
  schemas:
    AccountSubscribeParams:
      type: array
      items:
        oneOf:
          - type: string
            description: Account Pubkey, as base-58 encoded string
            examples:
              - "7Nw66LuLzJ3qnqgLkgUPQmzh51D7JvrXzJTnLvQksmKJ"
            default: "7Nw66LuLzJ3qnqgLkgUPQmzh51D7JvrXzJTnLvQksmKJ"
          - type: object
            properties:
              encoding:
                type: string
                enum: [base58, base64, base64+zstd, jsonParsed]
                description: Encoding format for account data
              commitment:
                type: string
                enum: [finalized, confirmed, processed]
                description: The commitment level for the subscription
            examples:
              - encoding: "jsonParsed"
                commitment: "finalized"
    
    AccountValue:
      type: object
      properties:
        data:
          oneOf:
            - type: array
              description: For base58/base64 encodings
            - type: object
              description: For jsonParsed encoding
        executable:
          type: boolean
        lamports:
          type: integer
        owner:
          type: string
        rentEpoch:
          type: integer
        space:
          type: integer
      examples:
        - data: 
            parsed: { /* parsed account data */ }
          executable: false
          lamports: 3486960
          owner: "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"
          rentEpoch: 361
          space: 165

  messages:
    AccountSubscribeRequest:
      title: Account Subscribe Request
      summary: Request to subscribe to an account to receive notifications when it changes
      description: Send this message to subscribe to updates for one or more accounts
      payload:
        type: object
        properties:
          jsonrpc:
            type: string
            const: "2.0"
            default: "2.0"
          id:
            type: integer
            default: 1
          method:
            type: string
            const: "accountSubscribe"
            default: "accountSubscribe"
          params:
            $ref: '#/components/schemas/AccountSubscribeParams'
        required:
          - jsonrpc
          - id
          - method
          - params
        examples:
          - jsonrpc: "2.0"
            id: 1
            method: "accountSubscribe"
            params: ["7Nw66LuLzJ3qnqgLkgUPQmzh51D7JvrXzJTnLvQksmKJ"]

    AccountSubscribeResponse:
      title: Account Subscribe Response
      summary: Response containing the subscription ID
      description: Response message with the subscription ID you'll need to track updates
      payload:
        type: object
        properties:
          jsonrpc:
            type: string
            const: "2.0"
          id:
            type: integer
          result:
            type: integer
            description: Subscription ID (needed to unsubscribe)
        required:
          - jsonrpc
          - result
          - id
        examples:
          - jsonrpc: "2.0"
            id: 1
            result: 23784

    AccountNotification:
      title: Account Notification
      summary: Notification sent when an account changes
      description: You'll receive this message whenever a subscribed account changes
      payload:
        type: object
        properties:
          jsonrpc:
            type: string
            const: "2.0"
          method:
            type: string
            const: "accountNotification"
          params:
            type: object
            properties:
              result:
                type: object
                properties:
                  context:
                    type: object
                    properties:
                      slot:
                        type: integer
                  value:
                    $ref: '#/components/schemas/AccountValue'
              subscription:
                type: integer
                description: Subscription ID
        required:
          - jsonrpc
          - method
          - params
        examples:
          - jsonrpc: "2.0"
            method: "accountNotification"
            params:
              result:
                context:
                  slot: 1122334
                value:
                  data: 
                    parsed: { /* parsed account data */ }
                  executable: false
                  lamports: 3486960
                  owner: "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"
                  rentEpoch: 361
                  space: 165
              subscription: 23784 